#!/usr/bin/with-contenv sh
# shellcheck shell=sh

cd /usr/src/app || exit 1

: "${APP_DATA_DIR:=/data}"
mkdir -p "${APP_DATA_DIR}/3mf" "${APP_DATA_DIR}/temp" "${APP_DATA_DIR}/tempDownload"

# 强制容器内监听地址和端口，确保 Supervisor ingress 能连接到容器
# Supervisor 会把 ingress 转发到容器的 5000 端口，确保绑定 0.0.0.0
export HOST="0.0.0.0"
export PORT="5000"

echo "Starting app with HOST=${HOST} PORT=${PORT} APP_DATA_DIR=${APP_DATA_DIR}"
ps aux || true

exec /usr/src/app/venv/bin/python -u app.py
